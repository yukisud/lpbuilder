<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LP Builder v22 (Material Banner Integrated)</title>
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+JP:wght@400;700;900&display=swap" rel="stylesheet">

  <!-- Dynamic Load for GAS Sandbox -->
  <script>
    // Tailwind CSS
    (function(){
      var s = document.createElement('script');
      s.src = "https://cdn.tailwindcss.com";
      s.onload = function() {
        tailwind.config = {
          theme: {
            extend: {
              fontFamily: { sans: ['Inter', 'Noto Sans JP', 'sans-serif'] },
              animation: { marquee: 'marquee 25s linear infinite' },
              keyframes: { marquee: { '0%': { transform: 'translateX(0)' }, '100%': { transform: 'translateX(-50%)' } } }
            }
          }
        };
      };
      document.head.appendChild(s);
    })();
    // Phosphor Icons
    (function(){
      var s = document.createElement('script');
      s.src = "https://unpkg.com/@phosphor-icons/web";
      document.head.appendChild(s);
    })();
  </script>

  <style>
    /* --- Base UI --- */
    body { margin: 0; overflow: hidden; background-color: #0f172a; color: #f8fafc; }
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #1e293b; }
    ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
    
    /* --- Preview Area --- */
    #preview-area {
      background-color: #f1f5f9;
      background-image: linear-gradient(#cbd5e1 1px, transparent 1px), linear-gradient(90deg, #cbd5e1 1px, transparent 1px);
      background-size: 20px 20px;
    }
    #canvas {
      min-height: 100vh;
      background: white;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      padding-bottom: 120px;
    }

    /* --- Editor UI --- */
    .editable-section { position: relative; border: 2px solid transparent; transition: all 0.2s; }
    .editable-section:hover::after { content: ""; position: absolute; inset: 0; border: 2px dashed #3b82f6; pointer-events: none; z-index: 40; }
    .editable-section.active::after { content: ""; position: absolute; inset: 0; border: 3px solid #2563eb; z-index: 40; }
    .editor-input, .editor-select, .editor-textarea {
      background: #1e293b; border: 1px solid #334155; color: white; 
      font-size: 13px; border-radius: 4px; padding: 8px; width: 100%; transition: 0.2s;
    }
    .editor-input:focus, .editor-select:focus, .editor-textarea:focus { outline: none; border-color: #60a5fa; ring: 1px solid #60a5fa; }
    .editor-label { display: block; font-size: 11px; font-weight: bold; color: #94a3b8; margin-bottom: 4px; text-transform: uppercase; }
    .panel-card { background: #1e293b; border: 1px solid #334155; padding: 12px; border-radius: 6px; margin-bottom: 8px; }

    /* --- Material Banner Styles (Added) --- */
    /* --- å®Œæˆç‰ˆ Material Banner Styles --- */

    /* ãƒãƒŠãƒ¼æœ¬ä½“ */
    .material-banner {
      display: flex;
      align-items: center;
      position: relative;
      padding: 18px 20px;
      border-radius: 12px;
      background: linear-gradient(90deg, #ff72d2, #6a5bff);
      color: white;
      text-decoration: none;
      overflow: visible;
      box-shadow: 0 6px 14px rgba(0,0,0,0.2);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      margin-bottom: 40px;
    }
    
    .material-banner:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.25);
    }
    
    /* å·¦ã®ä¸¸ã‚¢ã‚¤ã‚³ãƒ³ */
    .material-banner__icon {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      background: white;
      color: #7a36ff;
      font-size: 18px;
      font-weight: bold;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-right: 18px;
    }
    
    /* ãƒ†ã‚­ã‚¹ãƒˆ */
    .material-banner__text .line1 {
      font-size: 15px;
      font-weight: 700;
      color: #ffe54a;
    }
    
    .material-banner__text .line2 {
      font-size: 22px;
      font-weight: 800;
      display: block;
      margin-top: 4px;
    }
    
    /* --- è³‡æ–™ç”»åƒï¼ˆ3æšé‡ã­ï¼‰ --- */
    .material-banner__thumb-group {
      position: absolute;
      right: -10px;
      top: -20px;
      width: 260px;
      height: 180px;
      pointer-events: none;
    }
    
    /* å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
    .material-banner__thumb-group .thumb {
      position: absolute;
      width: 140px;
      height: 95px;
      border-radius: 6px;
      background-size: cover;
      background-position: center;
      box-shadow: 0 4px 8px rgba(0,0,0,0.25);
    }
    
    /* ãƒ€ãƒŸãƒ¼1ï¼ˆã»ã‚“ã®å°‘ã—å¾Œã‚ã«è¦‹ãˆã‚‹ï¼‰ */
    .material-banner__thumb-group .d1 {
      background: #ddd;
      transform: rotate(-6deg);
      top: 20px;
      right: 52px;
    }
    
    /* ãƒ€ãƒŸãƒ¼2ï¼ˆã•ã‚‰ã«æ§ãˆã‚ï¼‰ */
    .material-banner__thumb-group .d2 {
      background: #fff;
      transform: rotate(-2deg);
      top: 10px;
      right: 40px;
    }
    
    /* ä¸€ç•ªä¸Šã®æœ¬ç‰©ã®ç”»åƒ */
    .material-banner__thumb-group .main {
      width: 160px;
      height: 110px;
      transform: rotate(3deg);
      top: 5px;
      right: 10px;
      border-radius: 7px;
      object-fit: cover;
    }

    /* --- HubSpot Form Styling (Strict Override) --- */
    .hs-form { margin: 0 !important; padding: 0 !important; width: 100% !important; }
    .hs-form fieldset { border: none !important; padding: 0 !important; margin: 0 0 15px 0 !important; max-width: 100% !important; }
    .hs-form fieldset.form-columns-2 { display: flex !important; gap: 10px !important; }
    .hs-form fieldset.form-columns-2 .hs-form-field { width: 50% !important; float: none !important; }
    .hs-form .field { margin-bottom: 0 !important; }
    .hs-form label { display: block !important; font-size: 13px !important; font-weight: bold !important; color: #374151 !important; margin-bottom: 6px !important; }
    .hs-form-required { color: #ef4444 !important; margin-left: 4px !important; }
    .hs-form .hs-input {
      display: block !important; width: 100% !important; padding: 12px 16px !important;
      font-size: 14px !important; line-height: 1.5 !important; color: #1f2937 !important;
      background-color: #f9fafb !important; border: 1px solid #d1d5db !important;
      border-radius: 8px !important; box-sizing: border-box !important; transition: border-color 0.2s !important;
    }
    .hs-form .hs-input:focus { outline: none !important; border-color: var(--color-primary) !important; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important; }
    .hs-error-msgs { list-style: none !important; padding: 0 !important; margin: 4px 0 0 0 !important; }
    .hs-error-msg { color: #dc2626 !important; font-size: 12px !important; }
    .hs-form .actions { padding: 0 !important; margin-top: 20px !important; }
    .hs-form .hs-button {
      width: 100% !important; background-color: var(--color-primary) !important; color: white !important;
      font-weight: bold !important; font-size: 16px !important; padding: 14px !important;
      border-radius: 8px !important; border: none !important; cursor: pointer !important;
      transition: opacity 0.2s !important; text-align: center !important;
    }
    .hs-form .hs-button:hover { opacity: 0.9 !important; }

    /* --- Bubble Arrow --- */
    .bubble-arrow {
      position: absolute; bottom: -6px; left: 50%; transform: translateX(-50%);
      width: 0; height: 0; 
      border-left: 6px solid transparent; border-right: 6px solid transparent;
      border-top: 6px solid #fbbf24;
    }
  </style>
</head>
<body class="flex h-screen">

  <!-- Left: Preview -->
  <div id="preview-area" class="flex-1 overflow-y-auto p-0 md:p-8 flex justify-center items-start">
    <div id="canvas-wrapper" class="w-full max-w-[1280px]">
      <div id="canvas" class="text-slate-900 bg-white relative"></div>
    </div>
  </div>

  <!-- Right: Editor -->
  <div class="w-[380px] bg-slate-900 border-l border-slate-700 flex flex-col shadow-2xl z-50 flex-shrink-0">
    <div class="h-14 border-b border-slate-700 flex items-center justify-between px-4 bg-slate-800">
      <div class="font-bold text-white flex items-center gap-2">
        <i class="ph-fill ph-paint-brush-broad text-blue-500"></i> LP Builder v22
      </div>
      <button onclick="exportHtml()" class="bg-blue-600 hover:bg-blue-500 text-white text-xs font-bold px-3 py-1.5 rounded flex items-center gap-1 transition">
        <i class="ph-bold ph-code"></i> æ›¸å‡ºã—
      </button>
    </div>

    <div class="flex border-b border-slate-700 bg-slate-800/50">
      <button onclick="switchTab('global')" id="tab-global" class="flex-1 py-3 text-xs font-bold text-slate-400 border-b-2 border-transparent">å…¨ä½“è¨­å®š</button>
      <button onclick="switchTab('section')" id="tab-section" class="flex-1 py-3 text-xs font-bold text-blue-500 border-b-2 border-blue-500">ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç·¨é›†</button>
    </div>

    <div id="editor-content" class="flex-1 overflow-y-auto p-4 custom-scrollbar"></div>

    <div class="p-4 border-t border-slate-700 bg-slate-800">
      <p class="text-[10px] font-bold text-slate-500 mb-2 uppercase">ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ </p>
      <div class="grid grid-cols-2 gap-2">
        <button class="bg-slate-700 hover:bg-slate-600 text-white text-xs py-2 rounded flex items-center justify-center gap-1" onclick="addSection('hero')"><i class="ph ph-image"></i> FV (Hero)</button>
        <button class="bg-slate-700 hover:bg-slate-600 text-white text-xs py-2 rounded flex items-center justify-center gap-1" onclick="addSection('cta_middle')"><i class="ph ph-hand-pointing"></i> ä¸­é–“CTA</button>
        <button class="bg-slate-700 hover:bg-slate-600 text-white text-xs py-2 rounded flex items-center justify-center gap-1" onclick="addSection('contact')"><i class="ph ph-envelope"></i> ãŠå•ã„åˆã‚ã›</button>
        <button class="bg-slate-700 hover:bg-slate-600 text-white text-xs py-2 rounded flex items-center justify-center gap-1" onclick="addSection('case_study_detail')"><i class="ph ph-article"></i> æˆåŠŸäº‹ä¾‹è©³ç´°</button>
        <button class="bg-slate-700 hover:bg-slate-600 text-white text-xs py-2 rounded flex items-center justify-center gap-1" onclick="addSection('feature_hero')"><i class="ph ph-monitor"></i> ã‚µãƒ¼ãƒ“ã‚¹è©³ç´°</button>
        <button class="bg-slate-700 hover:bg-slate-600 text-white text-xs py-2 rounded flex items-center justify-center gap-1" onclick="addSection('comparison')"><i class="ph ph-scales"></i> æ¯”è¼ƒè¡¨</button>
        <button class="bg-slate-700 hover:bg-slate-600 text-white text-xs py-2 rounded flex items-center justify-center gap-1" onclick="addSection('pricing')"><i class="ph ph-currency-yen"></i> æ–™é‡‘</button>
        <button class="bg-slate-700 hover:bg-slate-600 text-white text-xs py-2 rounded flex items-center justify-center gap-1" onclick="addSection('achievements')"><i class="ph ph-chart-bar"></i> å®Ÿç¸¾(3col)</button>
        <button class="bg-slate-700 hover:bg-slate-600 text-white text-xs py-2 rounded flex items-center justify-center gap-1" onclick="addSection('flow')"><i class="ph ph-steps"></i> æµã‚Œ</button>
        <button class="bg-slate-700 hover:bg-slate-600 text-white text-xs py-2 rounded flex items-center justify-center gap-1" onclick="addSection('strengths')"><i class="ph ph-lightning"></i> å¼·ã¿</button>
        <button class="bg-slate-700 hover:bg-slate-600 text-white text-xs py-2 rounded flex items-center justify-center gap-1" onclick="addSection('problem')"><i class="ph ph-warning"></i> èª²é¡Œ</button>
        <button class="bg-slate-700 hover:bg-slate-600 text-white text-xs py-2 rounded flex items-center justify-center gap-1" onclick="addSection('agitation')"><i class="ph ph-fire"></i> å±æ©Ÿæ„Ÿ</button>
        <button class="bg-slate-700 hover:bg-slate-600 text-white text-xs py-2 rounded flex items-center justify-center gap-1" onclick="addSection('logos')"><i class="ph ph-slideshow"></i> ãƒ­ã‚´</button>
      </div>
    </div>
  </div>

  <script>
    /* --- Data & Config --- */
    const GRADIENTS = [
      { name: 'Blue', value: 'from-blue-600 to-cyan-400' },
      { name: 'Purple', value: 'from-indigo-600 to-purple-400' },
      { name: 'Orange', value: 'from-orange-500 to-red-400' },
      { name: 'Green', value: 'from-emerald-500 to-teal-400' }
    ];

    const initialState = {
      global: {
        serviceName: 'Denti SEO',
        companyName: 'ã‚¦ãƒŸã‚¬ãƒ¡æ ªå¼ä¼šç¤¾',
        logoUrl: '',
        ctaText: 'ãŠå•ã„åˆã‚ã›',
        ctaUrl: '#contact',
        subCtaTextSp: 'è³‡æ–™è«‹æ±‚', 
        subCtaUrlSp: '#',
        primaryColor: '#2563eb', // Blue-600
        secondaryColor: '#f97316', // Orange-500
        
        /* â–¼ è¿½åŠ  â–¼ */
        materialThumb: 'https://placehold.co/300x400?text=DOC',
        materialLeadText: 'è©³ã—ãçŸ¥ã‚ŠãŸã„æ–¹',
        materialBackgroundStart: '#ff72d2',
        materialBackgroundEnd: '#6a5bff'
      },
      sections: [
        {
          id: 's1', type: 'hero',
          data: {
            tagline: 'AI Powered Business Analytics',
            title: 'ãƒ“ã‚¸ãƒã‚¹ã®æœªæ¥ã‚’ã€<br>ãƒ‡ãƒ¼ã‚¿ã§åŠ é€Ÿã•ã›ã‚‹ã€‚',
            desc: 'ç›´æ„Ÿã ã‘ã§ãªãã€ç¢ºã‹ãªãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ãŸæ„æ€æ±ºå®šã‚’ã€‚NextVisionã¯ã€æœ€æ–°ã®AIæŠ€è¡“ã§æˆé•·æˆ¦ç•¥ã‚’å¯è¦–åŒ–ã—ã¾ã™ã€‚',
            userCount: '2,000ç¤¾ä»¥ä¸Š',
            bgImage: '',
            formCode: '',
            layout: 'split',
            showSubCta: true, subCtaText: '3åˆ†ã§ã‚ã‹ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ç´¹ä»‹è³‡æ–™', subCtaUrl: '#',
            microCopy: 'ç°¡å˜30ç§’'
          }
        },
        {
          id: 's2', type: 'logos',
          data: { 
            title: 'å°å…¥å®Ÿç¸¾ 500ç¤¾ä»¥ä¸Š', 
            items: [
              'https://placehold.co/200x80/e2e8f0/94a3b8?text=Logo+1',
              'https://placehold.co/200x80/e2e8f0/94a3b8?text=Logo+2',
              'https://placehold.co/200x80/e2e8f0/94a3b8?text=Logo+3',
              'https://placehold.co/200x80/e2e8f0/94a3b8?text=Logo+4'
            ] 
          }
        },
        {
          id: 's3', type: 'problem',
          data: {
            title: 'ã“ã‚“ãªèª²é¡Œã€æŠ±ãˆã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ',
            items: [
              { title: 'ãƒ‡ãƒ¼ã‚¿ãŒæ•£åœ¨', desc: 'ãƒ„ãƒ¼ãƒ«ãŒãƒãƒ©ãƒãƒ©ã§ç®¡ç†ãŒç…©é›‘ã€‚' },
              { title: 'å±äººçš„ãªé‹å–¶', desc: 'ã‚¹ã‚¿ãƒƒãƒ•ã®çµŒé¨“ã¨å‹˜é ¼ã¿ã«ãªã£ã¦ã„ã‚‹ã€‚' },
              { title: 'é›†æ‚£ã®åœæ»', desc: 'åºƒå‘Šã‚’å‡ºã—ã¦ã‚‚åŠ¹æœãŒè¦‹ãˆã«ãã„ã€‚' }
            ]
          }
        },
        {
          id: 's4', type: 'agitation',
          data: {
            title: 'ã€Œ2025å¹´ã®å´–ã€ã¯ã€<br>ã‚‚ã†ç›®ã®å‰ã«è¿«ã£ã¦ã„ã¾ã™ã€‚',
            desc: 'ãƒ‡ã‚¸ã‚¿ãƒ«åŒ–ã®é…ã‚Œã¯ã€ãã®ã¾ã¾çµŒå–¶ãƒªã‚¹ã‚¯ã«ç›´çµã—ã¾ã™ã€‚<br>ä»Šã€ãƒ‡ãƒ¼ã‚¿ã‚’æ­¦å™¨ã«å¤‰ãˆãªã‘ã‚Œã°ã€ç«¶äº‰ã‹ã‚‰è„±è½ã™ã‚‹æœªæ¥ãŒå¾…ã£ã¦ã„ã¾ã™ã€‚',
            badge: 'å¿…è¦ãªã®ã¯ã€èª°ã§ã‚‚ä½¿ãˆã‚‹ã€Œãƒ‡ãƒ¼ã‚¿çµŒå–¶ã€ã®ä»•çµ„ã¿'
          }
        },
        {
          id: 's5', type: 'feature_hero',
          data: {
            subTitle: 'Service',
            title: 'è¤‡é›‘ãªãƒ‡ãƒ¼ã‚¿ã‚’ã€<br>ã‚·ãƒ³ãƒ—ãƒ«ãªæ„æ€æ±ºå®šã¸ã€‚',
            desc: 'ç¤¾å†…ã«æ•£ã‚‰ã°ã‚‹ã‚ã‚‰ã‚†ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’APIã§è‡ªå‹•é€£æºã€‚AIãŒè‡ªå‹•ã§åˆ†æã‚’è¡Œã„ã€ã€Œæ¬¡ã«ä½•ã‚’ã™ã¹ãã‹ã€ã‚’ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«è¡¨ç¤ºã—ã¾ã™ã€‚',
            checklist: ['ä¸»è¦SaaSã¨ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯é€£æº', 'AIã«ã‚ˆã‚‹äºˆå®Ÿç®¡ç†', 'ãƒ¬ãƒãƒ¼ãƒˆè‡ªå‹•ç”Ÿæˆ'],
            image: ''
          }
        },
        {
          id: 's6', type: 'case_study_detail',
          data: {
            title: 'å°å…¥æˆåŠŸäº‹ä¾‹',
            items: [
              {
                name: 'Aæ­¯ç§‘åŒ»é™¢',
                headline: 'è‡ªè²»è¨ºç™‚ã®å£²ä¸ŠãŒ1.5å€ã«å¢—åŠ ',
                desc: 'äºˆç´„ã®ç©ºãçŠ¶æ³ã‚’AIãŒåˆ†æã—ã€æœ€é©ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ãƒªãƒã‚¤ãƒ³ãƒ‰ã‚’é€ã‚‹ã“ã¨ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç‡ãŒæ¿€æ¸›ã—ã¾ã—ãŸã€‚',
                image1: '', image2: '',
                graphType: 'bar',
                metric: { label: 'å£²ä¸Š', before: 300, after: 450, unit: 'ä¸‡å††' }
              }
            ]
          }
        },
        {
          id: 's7', type: 'comparison',
          data: {
            title: 'å¾“æ¥æ‰‹æ³•ã¨ã®æ¯”è¼ƒ',
            cols: ['è‡ªç¤¾ (NextVision)', 'å¤§æ‰‹BIãƒ„ãƒ¼ãƒ«', 'Excelç®¡ç†'],
            rows: [
              { label: 'å°å…¥ã‚³ã‚¹ãƒˆ', values: ['æœˆé¡ 3ä¸‡å††~', 'æ•°åƒä¸‡å††~', '0å†† (äººä»¶è²»å¤§)'] },
              { label: 'å°å…¥æœŸé–“', values: ['æœ€çŸ­å³æ—¥', 'åŠå¹´ä»¥ä¸Š', '-'] }
            ]
          }
        },
        {
          id: 's8', type: 'cta_middle',
          data: {
            title: 'ã¾ãšã¯ç„¡æ–™ãƒ‡ãƒ¢ã§ã€<br>ãã®åŠ¹æœã‚’ä½“æ„Ÿã—ã¦ãã ã•ã„',
            desc: 'ã‚ãšã‹30ç§’ã§ç™»éŒ²å®Œäº†ã€‚ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ç™»éŒ²ã‚‚ä¸è¦ã§ã™ã€‚',
            btnText: 'ç„¡æ–™ã§è©¦ã—ã¦ã¿ã‚‹',
            btnUrl: '#contact',
            bgImage: '',
            microCopy: '30ç§’ã§ç™»éŒ²å®Œäº†',
            showSubCta: true, subCtaText: 'ã‚µãƒ¼ãƒ“ã‚¹è³‡æ–™ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰', subCtaUrl: '#'
          }
        },
        {
          id: 's9', type: 'achievements',
          data: {
            title: 'å®Ÿç¸¾ãƒ‡ãƒ¼ã‚¿',
            items: [
              { name: 'Aç¤¾', metric: 'ã‚³ã‚¹ãƒˆå‰Šæ¸›', before: 100, after: 40, unit: 'ä¸‡' },
              { name: 'Bç¤¾', metric: 'æˆç´„æ•°', before: 10, after: 35, unit: 'ä»¶' }
            ]
          }
        },
        {
          id: 's10', type: 'flow',
          data: {
            title: 'å°å…¥ã¾ã§ã®æµã‚Œ',
            steps: [
              { title: 'è³‡æ–™è«‹æ±‚ãƒ»ãŠå•ã„åˆã‚ã›', desc: 'ã¾ãšã¯ãƒ•ã‚©ãƒ¼ãƒ ã‚ˆã‚Šã”é€£çµ¡ãã ã•ã„ã€‚' },
              { title: 'ç„¡æ–™ãƒ‡ãƒ¢ãƒ»ãƒ’ã‚¢ãƒªãƒ³ã‚°', desc: 'å®Ÿéš›ã®ç”»é¢ã‚’ã”è¦§ã„ãŸã ããªãŒã‚‰èª²é¡Œã‚’æ•´ç†ã—ã¾ã™ã€‚' },
              { title: 'ãƒˆãƒ©ã‚¤ã‚¢ãƒ«é–‹å§‹', desc: '2é€±é–“ã®ç„¡æ–™ãƒˆãƒ©ã‚¤ã‚¢ãƒ«ã§åŠ¹æœã‚’å®Ÿæ„Ÿã—ã¦ãã ã•ã„ã€‚' },
              { title: 'æœ¬å¥‘ç´„ãƒ»é‹ç”¨é–‹å§‹', desc: 'å°‚ä»»ã‚¹ã‚¿ãƒƒãƒ•ãŒã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’æ”¯æ´ã—ã¾ã™ã€‚' }
            ]
          }
        },
        {
          id: 's11', type: 'pricing',
          data: {
            title: 'æ–™é‡‘ãƒ—ãƒ©ãƒ³',
            desc: 'åˆæœŸè²»ç”¨0å††ã€‚',
            plans: [
              { name: 'Starter', price: '30,000', note: 'å°è¦æ¨¡å‘ã‘', features: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼5å\nåŸºæœ¬æ©Ÿèƒ½', highlight: false },
              { name: 'Standard', price: '80,000', note: 'æˆé•·ä¼æ¥­å‘ã‘', features: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼20å\nAPIé€£æº', highlight: true }
            ]
          }
        },
        {
          id: 's12', type: 'faq',
          data: {
            title: 'ã‚ˆãã‚ã‚‹ã”è³ªå•',
            items: [{ q: 'ç„¡æ–™ãƒˆãƒ©ã‚¤ã‚¢ãƒ«ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', a: 'ã¯ã„ã€2é€±é–“ç„¡æ–™ã§ãŠè©¦ã—ã„ãŸã ã‘ã¾ã™ã€‚' }]
          }
        },
        {
          id: 's13', type: 'contact',
          data: {
            title: 'ãƒ“ã‚¸ãƒã‚¹ã®æˆé•·ã‚’ã€<br>ã“ã‚Œä»¥ä¸Šå¾…ã¤å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚',
            desc: 'ä»Šã™ãNextVisionã§ã€ãƒ‡ãƒ¼ã‚¿ãƒ‰ãƒªãƒ–ãƒ³ãªçµŒå–¶ã¸ã€‚',
            formCode: '',
            microCopy: 'ç°¡å˜30ç§’',
            showSubCta: true, subCtaText: 'ã‚µãƒ¼ãƒ“ã‚¹è³‡æ–™ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰', subCtaUrl: '#'
          }
        }
      ]
    };

    let lpData = JSON.parse(JSON.stringify(initialState));
    let activeId = 's1';
    let currentTab = 'section';

    /* --- Rendering --- */

    function render() {
      const canvas = document.getElementById('canvas');
      const g = lpData.global;
      let html = '';

      // CSS Injection for Dynamic Colors & Layout
      const cssVars = `
        <style>
          :root {
            --color-primary: ${g.primaryColor};
            --color-secondary: ${g.secondaryColor};
          }
          .bg-primary { background-color: var(--color-primary) !important; }
          .text-primary { color: var(--color-primary) !important; }
          .border-primary { border-color: var(--color-primary) !important; }
          .bg-secondary { background-color: var(--color-secondary) !important; }
          .text-secondary { color: var(--color-secondary) !important; }
          
          .btn-main { background-color: var(--color-primary) !important; color: white !important; }
          .btn-main:hover { opacity: 0.9; }
          
          /* SP Sticky Sub Button (Bordered) */
          .btn-sub-sticky {
            background-color: white !important;
            color: var(--color-secondary) !important;
            border: 2px solid var(--color-secondary) !important;
            text-decoration: none !important;
          }
          
          .bubble-box { background-color: #fbbf24; color: black; }
          .bubble-arrow { border-top-color: #fbbf24; }

          /* HubSpot Overrides */
          .hbspt-form .hs-button { background-color: var(--color-primary) !important; }
        </style>
      `;
      html += cssVars;

      // Header
      const logoContent = g.logoUrl 
        ? `<img src="${g.logoUrl}" alt="${g.serviceName}" class="h-8 w-auto object-contain">` 
        : `<div class="flex items-center gap-2 font-bold text-xl text-gray-900"><div class="w-8 h-8 rounded-lg bg-primary text-white flex items-center justify-center">N</div>${g.serviceName}</div>`;

      html += `
        <header class="sticky top-0 z-30 bg-white/95 backdrop-blur border-b border-gray-100">
          <div class="container mx-auto px-6 h-16 flex justify-between items-center">
            ${logoContent}
            <nav class="hidden md:flex gap-6 text-sm font-medium text-gray-600">
               <a href="#" class="hover:text-primary transition">æ©Ÿèƒ½</a>
               <a href="#" class="hover:text-primary transition">äº‹ä¾‹</a>
               <a href="#" class="hover:text-primary transition">æ–™é‡‘</a>
            </nav>
            <a href="${g.ctaUrl}" class="hidden md:inline-flex px-5 py-2 rounded-full text-sm font-bold shadow-lg btn-main transition">
              ${g.ctaText}
            </a>
          </div>
        </header>
      `;

      // Sections
      lpData.sections.forEach(sec => {
        const isActive = sec.id === activeId ? 'active' : '';
        html += `<div class="editable-section ${isActive}" onclick="selectSection('${sec.id}')">`;
        switch(sec.type) {
          case 'hero': html += tplHero(sec.data, sec.id); break;
          case 'logos': html += tplLogos(sec.data); break;
          case 'cta_middle': html += tplCtaMiddle(sec.data); break;
          case 'feature_hero': html += tplFeatureHero(sec.data); break;
          case 'case_study_detail': html += tplCaseStudyDetail(sec.data); break;
          case 'comparison': html += tplComparison(sec.data); break;
          case 'strengths': html += tplStrengths(sec.data); break;
          case 'achievements': html += tplAchievements(sec.data); break;
          case 'pricing': html += tplPricing(sec.data); break;
          case 'faq': html += tplFaq(sec.data); break;
          case 'contact': html += tplContact(sec.data, sec.id); break;
          case 'problem': html += tplProblem(sec.data); break;
          case 'agitation': html += tplAgitation(sec.data); break;
          case 'flow': html += tplFlow(sec.data); break;
        }
        html += `</div>`;
      });

      // Footer
      html += `
        <footer class="bg-slate-900 text-slate-400 py-12 border-t border-slate-800">
          <div class="container mx-auto px-6 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="font-bold text-white text-lg">${g.serviceName}</div>
            <div class="text-xs">Â© 2025 ${g.companyName} All rights reserved.</div>
          </div>
        </footer>
      `;

      // SP Sticky Button (2 Buttons, pb-4 = 1rem)
      html += `
        <div class="md:hidden fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 p-4 shadow-2xl z-50 flex gap-2 pb-4">
           <a href="${g.subCtaUrlSp}" class="flex-1 py-3 rounded-lg font-bold text-center shadow-lg btn-sub-sticky text-sm flex items-center justify-center">
             ${g.subCtaTextSp}
           </a>
           <a href="${g.ctaUrl}" class="flex-1 py-3 rounded-lg font-bold text-center shadow-lg btn-main text-sm flex items-center justify-center">
             ${g.ctaText}
           </a>
        </div>
      `;

      canvas.innerHTML = html;
      loadHubSpotScripts();
    }

    /* --- Helper: Buttons & Layout & Banner --- */
    
    // ğŸ¯ â‘¢ æ–°é–¢æ•°: renderMaterialBanner
    function renderMaterialBanner(subText, subUrl) {
      const g = lpData.global;
      const thumb = g.materialThumb || 'https://placehold.co/300x400?text=DOC';
    
      const lead = g.materialLeadText || 'è©³ã—ãçŸ¥ã‚ŠãŸã„æ–¹';
    
      const gradStart = g.materialBackgroundStart || '#ff72d2';
      const gradEnd = g.materialBackgroundEnd || '#6a5bff';
    
      return `
        <a href="${subUrl}" class="material-banner"
           style="background: linear-gradient(90deg, ${gradStart}, ${gradEnd});">
    
          <div class="material-banner__icon">â–¶</div>
    
          <div class="material-banner__text">
            <span class="line1">${lead}</span>
            <span class="line2">${subText}</span>
          </div>
    
          <div class="material-banner__thumb-group">
            <div class="thumb dummy d1"></div>
            <div class="thumb dummy d2"></div>
            <img src="${thumb}" class="thumb main">
          </div>
    
        </a>
      `;
    }


    function renderBtnGroup(mainText, mainUrl, showSub, subText, subUrl, microCopy) {
      // ãƒã‚¤ã‚¯ãƒ­ã‚³ãƒ”ãƒ¼: relativeé…ç½® (ä¸­å¤®å¯„ã›)
      const bubble = microCopy ? `
        <div class="relative inline-flex items-center justify-center bubble-box text-xs font-bold px-4 py-1.5 rounded-full shadow-md animate-bounce whitespace-nowrap mb-2">
           ${microCopy}
           <div class="bubble-arrow" style="position:absolute; bottom:-6px; left:50%; transform:translateX(-50%); border-left:6px solid transparent; border-right:6px solid transparent; border-top:6px solid #fbbf24;"></div>
        </div>` : '';

      // ğŸ¯ ã‚µãƒ–CTAã®ç½®ãæ›ãˆ (Material Banner)
      const sub = showSub ? `
        <div class="w-full md:w-auto flex justify-center">
           ${renderMaterialBanner(subText, subUrl)}
        </div>
      ` : '';

      const main = `
        <div class="flex flex-col items-center w-full md:w-auto relative">
           ${bubble}
           <a href="${mainUrl}" class="block w-full md:w-64 py-4 rounded-lg font-bold text-center shadow-lg transition btn-main text-lg relative z-0 border-2 border-white/20">
             ${mainText}
           </a>
        </div>
      `;

      return `
        <div class="flex flex-col md:flex-row items-end justify-center gap-8 md:gap-12 mt-12 w-full">
           ${sub}
           ${main}
        </div>
      `;
    }

    /* --- HubSpot --- */
    function loadHubSpotScripts() {
      if (!window.hbspt && !document.querySelector('script[src*="hsforms.net"]')) {
        const script = document.createElement('script');
        script.src = "//js-na2.hsforms.net/forms/embed/v2.js";
        script.onload = () => runHubSpotEmbeds();
        document.body.appendChild(script);
      } else {
        setTimeout(runHubSpotEmbeds, 100);
      }
    }
    function runHubSpotEmbeds() {
      if (!window.hbspt) return;
      document.querySelectorAll('.hs-form-wrapper').forEach(w => {
        const portalId = w.dataset.portalId;
        const formId = w.dataset.formId;
        const region = w.dataset.region || 'na1';
        if (portalId && formId) {
          w.innerHTML = ''; 
          window.hbspt.forms.create({ region, portalId, formId, target: '#' + w.id });
        }
      });
    }
    function parseHubSpotCode(code) {
      if (!code) return null;
      const p = code.match(/portalId:\s*["']?(\d+)["']?/);
      const f = code.match(/formId:\s*["']?([a-zA-Z0-9-]+)["']?/);
      const r = code.match(/region:\s*["']?([a-zA-Z0-9]+)["']?/);
      if (p && f) return { portalId: p[1], formId: f[1], region: r ? r[1] : 'na1' };
      return null;
    }

    /* --- Templates --- */

    function tplHero(d, id) {
      const bgStyle = d.bgImage ? `background-image: url('${d.bgImage}'); background-size: cover; background-position: center;` : '';
      let formHtml = '';
      const hsData = parseHubSpotCode(d.formCode);
      if (hsData) formHtml = `
        <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100 text-left">
          <h3 class="text-lg font-bold text-center mb-4 text-gray-800">ç„¡æ–™ç›¸è«‡ã¯ã“ã¡ã‚‰ã‹ã‚‰</h3>
          <div id="hs-hero-${id}" class="hs-form-wrapper" data-portal-id="${hsData.portalId}" data-form-id="${hsData.formId}" data-region="${hsData.region}"></div>
        </div>`;
      else formHtml = `
        <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
           <h3 class="text-lg font-bold text-center mb-4 text-gray-800">ç„¡æ–™ç›¸è«‡ã¯ã“ã¡ã‚‰ã‹ã‚‰</h3>
           <div class="space-y-3">
             <input type="text" placeholder="ä¼šç¤¾å" class="w-full bg-gray-50 border border-gray-200 rounded px-3 py-3 text-sm">
             <input type="email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" class="w-full bg-gray-50 border border-gray-200 rounded px-3 py-3 text-sm">
             <button class="w-full btn-main font-bold py-3 rounded shadow">ç”³ã—è¾¼ã‚€</button>
           </div>
        </div>`;

      // ğŸ¯ â‘¤ ç½®ãæ›ãˆã‚³ãƒ¼ãƒ‰ï¼ˆHeroï¼‰
      const ctaArea = d.showSubCta
        ? `<div class="mt-6">${renderMaterialBanner(d.subCtaText, d.subCtaUrl)}</div>`
        : '';

      let layoutHtml = '';
      if (d.layout === 'overlay_box') {
         layoutHtml = `
           <div class="container mx-auto px-6 relative z-10 flex justify-end">
             <div class="bg-white/95 backdrop-blur p-8 rounded-xl shadow-2xl max-w-lg w-full">
               <div class="inline-block px-3 py-1 bg-blue-50 text-primary rounded-full text-xs font-bold uppercase mb-4 border border-blue-100">${d.tagline}</div>
               <h1 class="text-3xl font-extrabold text-gray-900 leading-tight mb-4">${d.title}</h1>
               <p class="text-gray-600 mb-6">${d.desc}</p>
               ${formHtml}
               ${ctaArea}
             </div>
           </div>
         `;
      } else {
         layoutHtml = `
           <div class="container mx-auto px-6 relative z-10">
            <div class="flex flex-col lg:flex-row items-center gap-12 lg:gap-20">
              <div class="lg:w-1/2 space-y-6">
                <div class="inline-block px-3 py-1 bg-blue-50 text-primary rounded-full text-xs font-bold uppercase border border-blue-100">${d.tagline}</div>
                <h1 class="text-4xl lg:text-6xl font-extrabold tracking-tight leading-tight text-gray-900">${d.title}</h1>
                <p class="text-lg text-gray-600 leading-relaxed max-w-lg">${d.desc}</p>
                <div class="flex items-center gap-3 pt-4"><span class="text-sm font-bold text-gray-700">ğŸ† ${d.userCount} å°å…¥</span></div>
              </div>
              <div class="lg:w-1/2 w-full max-w-md mx-auto lg:ml-auto">
                 ${formHtml}
                 ${ctaArea}
              </div>
            </div>
           </div>
         `;
      }

      return `
        <section class="relative pt-20 pb-20 lg:pt-32 lg:pb-32 overflow-hidden bg-white" style="${bgStyle}">
          ${d.layout === 'overlay_box' ? '' : '<div class="absolute top-0 right-0 -mr-20 -mt-20 w-[600px] h-[600px] bg-blue-50 rounded-full blur-3xl opacity-50 z-0 pointer-events-none"></div>'}
          ${layoutHtml}
        </section>
      `;
    }

    function tplCtaMiddle(d) {
      const bg = d.bgImage ? `background-image: url('${d.bgImage}'); background-size: cover;` : 'background: linear-gradient(135deg, #1e3a8a, #2563eb);';
      const overlay = d.bgImage ? '<div class="absolute inset-0 bg-slate-900/80"></div>' : '';
      
      const buttons = renderBtnGroup(d.btnText, d.btnUrl, d.showSubCta, d.subCtaText, d.subCtaUrl, d.microCopy);

      return `
        <section class="py-20 relative text-white text-center overflow-hidden" style="${bg}">
          ${overlay}
          <div class="container mx-auto px-6 relative z-10 flex flex-col items-center">
            <h2 class="text-3xl md:text-4xl font-bold mb-6 leading-tight">${d.title}</h2>
            <p class="text-blue-100 mb-8 max-w-2xl text-lg">${d.desc}</p>
            <div class="w-full max-w-4xl text-gray-800">
               ${buttons}
            </div>

          </div>
        </section>
      `;
    }

    function tplCaseStudyDetail(d) {
      const items = d.items.map(i => {
        const images = [];
        if(i.image1) images.push(`<img src="${i.image1}" class="rounded-lg shadow-md w-full h-48 object-cover">`);
        if(i.image2) images.push(`<img src="${i.image2}" class="rounded-lg shadow-md w-full h-48 object-cover">`);
        const imgGrid = images.length > 0 ? `<div class="grid grid-cols-${images.length} gap-4 mb-6">${images.join('')}</div>` : '';

        let graphHtml = '';
        if (i.metric) {
           const m = i.metric;
           const max = Math.max(m.before, m.after) * 1.1;
           if (i.graphType === 'bar') {
             const hB = (m.before / max) * 100;
             const hA = (m.after / max) * 100;
             graphHtml = `
               <div class="mt-6 p-4 bg-gray-50 rounded-xl border border-gray-100">
                 <div class="font-bold text-center text-gray-600 mb-4">${m.label}ã®æ¨ç§»</div>
                 <div class="relative h-40 flex items-end justify-center gap-8 px-4">
                   <div class="flex flex-col justify-end h-full w-16 text-center group">
                     <div class="text-xs text-gray-400 mb-1">Before</div>
                     <div class="w-full bg-gray-300 rounded-t transition-all group-hover:bg-gray-400" style="height:${hB}%"></div>
                     <div class="text-sm font-bold text-gray-600 mt-1">${m.before}</div>
                   </div>
                   <div class="flex flex-col justify-end h-full w-16 text-center relative group">
                     <div class="absolute -top-8 left-1/2 -translate-x-1/2 bg-red-500 text-white text-xs font-bold px-2 py-0.5 rounded animate-bounce whitespace-nowrap">UP!</div>
                     <div class="text-xs text-primary mb-1">After</div>
                     <div class="w-full bg-primary rounded-t shadow-lg" style="height:${hA}%"></div>
                     <div class="text-xl font-bold text-primary mt-1">${m.after}</div>
                   </div>
                 </div>
                 <div class="text-center text-xs text-gray-400 mt-2">å˜ä½: ${m.unit}</div>
               </div>
             `;
           } else {
             graphHtml = `
               <div class="mt-6 p-6 bg-gray-50 rounded-xl border border-gray-100 flex flex-col items-center">
                 <div class="font-bold text-gray-600 mb-4">${m.label}</div>
                 <div class="w-32 h-32 rounded-full relative shadow-inner" style="background: conic-gradient(var(--color-primary) 0% 70%, #e5e7eb 70% 100%);">
                    <div class="absolute inset-4 bg-white rounded-full flex items-center justify-center flex-col">
                       <span class="text-2xl font-bold text-primary">${m.after}${m.unit}</span>
                       <span class="text-xs text-gray-400">é”æˆ</span>
                    </div>
                 </div>
               </div>
             `;
           }
        }

        return `
          <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden mb-12">
            <div class="p-8 md:p-12">
              <div class="flex flex-col md:flex-row gap-10">
                <div class="md:w-1/2">
                  <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 rounded-full bg-blue-50 text-primary flex items-center justify-center"><i class="ph-fill ph-buildings text-xl"></i></div>
                    <span class="font-bold text-gray-500">${i.name}</span>
                  </div>
                  <h3 class="text-2xl md:text-3xl font-bold text-gray-900 mb-6 leading-tight">${i.headline}</h3>
                  <p class="text-gray-600 leading-relaxed mb-6">${i.desc}</p>
                  ${imgGrid}
                </div>
                <div class="md:w-1/2 flex flex-col justify-center">
                   ${graphHtml}
                </div>
              </div>
            </div>
          </div>
        `;
      }).join('');

      return `
        <section class="py-24 bg-white">
          <div class="container mx-auto px-6 max-w-5xl">
            <h2 class="text-3xl font-bold text-center text-gray-900 mb-16">${d.title}</h2>
            <div>${items}</div>
          </div>
        </section>
      `;
    }

    function tplContact(d, id) {
      let formHtml = '';
      const hsData = parseHubSpotCode(d.formCode);
      if (hsData) formHtml = `
        <div class="bg-white p-8 rounded-2xl shadow-xl text-gray-800">
          <h3 class="text-xl font-bold mb-6 text-center">ç„¡æ–™ç›¸è«‡ã¯ã“ã¡ã‚‰ã‹ã‚‰</h3>
          <div id="hs-contact-${id}" class="hs-form-wrapper" data-portal-id="${hsData.portalId}" data-form-id="${hsData.formId}" data-region="${hsData.region}"></div>
        </div>`;
      else formHtml = `
         <div class="bg-white p-8 rounded-2xl shadow-xl text-gray-800">
           <h3 class="text-xl font-bold mb-6 text-center">ç„¡æ–™ç›¸è«‡ã¯ã“ã¡ã‚‰ã‹ã‚‰</h3>
           <div class="space-y-4">
             <input type="text" placeholder="ä¼šç¤¾å" class="w-full px-4 py-3 rounded-lg bg-gray-50 border border-gray-200">
             <input type="email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" class="w-full px-4 py-3 rounded-lg bg-gray-50 border border-gray-200">
             <button class="w-full py-4 btn-main font-bold rounded-lg shadow-lg">è³‡æ–™ã‚’è«‹æ±‚ã™ã‚‹</button>
           </div>
         </div>`;

      // ğŸ¯ â‘¤ ç½®ãæ›ãˆã‚³ãƒ¼ãƒ‰ï¼ˆContactï¼‰
      const subCtaArea = d.showSubCta
        ? `
          <div class="mt-12 text-center bg-white/10 p-6 rounded-xl backdrop-blur-sm">
             <p class="text-blue-100 text-sm mb-4">ã¾ãšã¯ç„¡æ–™è³‡æ–™ã§å†…å®¹ã ã‘ç¢ºèªã—ãŸã„æ–¹ã¸</p>
             <div class="flex justify-center">
               ${renderMaterialBanner(d.subCtaText, d.subCtaUrl)}
             </div>
          </div>`
        : '';

      return `
        <section id="contact" class="py-24 bg-gradient-to-br from-slate-900 to-slate-800 text-white">
          <div class="container mx-auto px-6">
            <div class="flex flex-col lg:flex-row gap-16 items-start">
              <div class="lg:w-1/2 pt-10">
                <h2 class="text-3xl md:text-4xl font-bold mb-6 leading-tight">${d.title}</h2>
                <p class="text-blue-100 mb-8 text-lg">${d.desc}</p>
                ${subCtaArea}
              </div>
              <div class="lg:w-1/2 w-full">${formHtml}</div>
            </div>
          </div>
        </section>
      `;
    }

    /* --- Other Templates --- */
    function tplFeatureHero(d) {
      const list = d.checklist.map(item => `<li class="flex items-center gap-3"><i class="ph-fill ph-check-circle text-primary text-xl"></i><span class="text-gray-800 font-medium">${item}</span></li>`).join('');
      let imgContent = d.image ? `<img src="${d.image}" alt="Service" class="w-full h-auto rounded shadow-lg">` : `<div class="aspect-square bg-gray-100 rounded-3xl flex items-center justify-center text-gray-400 font-bold">NO IMAGE</div>`;
      return `<section class="py-24 bg-white"><div class="container mx-auto px-6"><div class="flex flex-col md:flex-row items-center gap-16"><div class="md:w-1/2">${imgContent}</div><div class="md:w-1/2 space-y-6"><span class="text-primary font-bold tracking-wider text-sm uppercase">${d.subTitle}</span><h2 class="text-4xl font-bold text-gray-900 leading-tight">${d.title}</h2><p class="text-gray-600 leading-relaxed text-lg">${d.desc}</p><ul class="space-y-4 pt-4">${list}</ul></div></div></div></section>`;
    }
    function tplLogos(d) {
      const items = [...d.items, ...d.items, ...d.items].map(i=>`<img src="${i}" class="h-12 w-auto mx-10 grayscale opacity-70 hover:grayscale-0 transition duration-300 object-contain">`).join('');
      return `<div class="w-full overflow-hidden bg-gray-50 py-10 border-b border-gray-200"><div class="text-center mb-6 text-xs text-gray-500 tracking-widest font-bold uppercase">${d.title}</div><div class="relative w-full flex overflow-x-hidden"><div class="animate-marquee whitespace-nowrap py-2 flex items-center">${items}</div></div></div>`;
    }
    function tplComparison(d) {
      const headers = d.cols.map((col, i) => `<th class="p-4 ${i===0?'bg-primary text-white':'bg-gray-100 text-gray-700'} font-bold text-center w-1/${d.cols.length+1}">${col}</th>`).join('');
      const rows = d.rows.map(row => {
        const cells = row.values.map((val, i) => `<td class="p-4 text-center ${i===0?'bg-blue-50 text-primary font-bold border-x border-blue-100':'text-gray-600'}">${val}</td>`).join('');
        return `<tr class="border-b border-gray-100 last:border-0"><td class="p-4 font-bold text-gray-700">${row.label}</td>${cells}</tr>`;
      }).join('');
      return `<section class="py-24 bg-white"><div class="container mx-auto px-6 max-w-5xl"><h2 class="text-3xl font-bold text-center text-gray-900 mb-12">${d.title}</h2><div class="overflow-x-auto shadow-lg rounded-xl border border-gray-200"><table class="w-full text-left border-collapse min-w-[600px]"><thead><tr><th class="p-4 bg-gray-50 w-1/4"></th>${headers}</tr></thead><tbody>${rows}</tbody></table></div></div></section>`;
    }
    function tplStrengths(d) {
      const items = d.features.map((f,i)=>{
        const rev=i%2!==0?'md:flex-row-reverse':'md:flex-row';
        return `<div class="flex flex-col ${rev} items-center gap-10 md:gap-16 py-12 border-b border-gray-100 last:border-0"><div class="w-full md:w-1/2"><div class="aspect-video rounded-2xl bg-gradient-to-br ${f.color} p-1 shadow-lg"><div class="w-full h-full bg-white rounded-xl flex items-center justify-center text-gray-300 font-bold">IMAGE</div></div></div><div class="w-full md:w-1/2"><div class="inline-block px-3 py-1 rounded-full text-xs font-bold text-white mb-4 bg-gradient-to-r ${f.color}">POINT 0${i+1}</div><h3 class="text-2xl font-bold text-gray-900 mb-4">${f.title}</h3><p class="text-gray-600 leading-relaxed">${f.desc}</p></div></div>`;
      }).join('');
      return `<section class="py-24 bg-white"><div class="container mx-auto px-6"><div class="text-center mb-16"><span class="text-primary font-bold text-xs tracking-widest uppercase">${d.subTitle}</span><h2 class="text-3xl font-bold text-gray-900 mt-2">${d.mainTitle}</h2></div><div>${items}</div></div></section>`;
    }
    function tplPricing(d) {
      const cards = d.plans.map(p => {
        const w=p.highlight?'border-2 border-primary shadow-xl relative z-10 scale-105':'border border-gray-200 shadow-sm';
        const b=p.highlight?'<span class="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-primary text-white text-[10px] font-bold px-3 py-1 rounded-full">POPULAR</span>':'';
        const f=p.features.split('\n').map(x=>`<li class="flex items-start gap-2 text-sm text-gray-600"><i class="ph-fill ph-check-circle text-primary mt-0.5"></i>${x}</li>`).join('');
        return `<div class="bg-white rounded-2xl p-8 flex flex-col ${w}">${b}<h3 class="text-lg font-bold text-gray-800 mb-2">${p.name}</h3><p class="text-xs text-gray-500 mb-6 font-bold">${p.note||''}</p><div class="text-3xl font-bold text-gray-900 mb-6">${p.price}<span class="text-xs text-gray-400 font-normal ml-1">/æœˆ</span></div><ul class="space-y-3 mb-4 flex-1">${f}</ul></div>`;
      }).join('');
      return `<section class="py-24 bg-slate-50"><div class="container mx-auto px-6"><div class="text-center mb-12"><h2 class="text-3xl font-bold text-gray-900 mb-4">${d.title}</h2><p class="text-gray-500 text-sm max-w-xl mx-auto">${d.desc}</p></div><div class="grid md:grid-cols-${Math.min(d.plans.length,3)} gap-6 max-w-6xl mx-auto items-start">${cards}</div></div></section>`;
    }
    function tplProblem(d) {
      const cards = d.items.map(i=>`<div class="bg-white p-8 rounded-2xl shadow-sm border border-gray-100 text-center"><div class="w-16 h-16 bg-red-50 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl"><i class="ph-fill ph-warning-circle"></i></div><h3 class="font-bold text-lg mb-2 text-gray-800">${i.title}</h3><p class="text-sm text-gray-600">${i.desc}</p></div>`).join('');
      return `<section class="py-20 bg-gray-50"><div class="container mx-auto px-6"><h2 class="text-3xl font-bold text-center text-gray-900 mb-12">${d.title}</h2><div class="grid md:grid-cols-3 gap-8">${cards}</div></div></section>`;
    }
    function tplAgitation(d) {
      return `<section class="py-24 bg-slate-900 text-white text-center relative overflow-hidden"><div class="absolute inset-0 opacity-10" style="background-image: url('https://www.transparenttextures.com/patterns/carbon-fibre.png');"></div><div class="container mx-auto px-6 relative z-10 max-w-4xl"><h2 class="text-3xl md:text-5xl font-bold mb-8 leading-tight">${d.title}</h2><p class="text-gray-300 text-lg md:text-xl leading-relaxed mb-10">${d.desc}</p><div class="inline-block p-1 rounded-full bg-gradient-to-r from-blue-600 to-cyan-500"><div class="px-8 py-3 bg-slate-900 rounded-full font-bold text-blue-200">${d.badge}</div></div></div></section>`;
    }
    function tplFlow(d) {
      const s = d.steps.map((x,i)=>`<div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 relative"><div class="w-12 h-12 bg-primary text-white rounded-full flex items-center justify-center font-bold text-xl mb-4 mx-auto md:mx-0 shadow-lg">0${i+1}</div><h3 class="font-bold text-gray-800 mb-2 text-center md:text-left">${x.title}</h3><p class="text-sm text-gray-500 text-center md:text-left">${x.desc}</p></div>`).join('');
      return `<section class="py-20 bg-gray-50"><div class="container mx-auto px-6"><div class="text-center mb-16"><h2 class="text-3xl font-bold text-gray-900">${d.title}</h2></div><div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-6xl mx-auto">${s}</div></div></section>`;
    }
    function tplAchievements(d) {
      const c = d.items.map(i=>`<div class="bg-white rounded-xl shadow border border-gray-100 p-6 flex flex-col h-full"><div class="flex items-center gap-3 mb-6"><div class="w-10 h-10 rounded-full bg-blue-50 text-primary flex items-center justify-center"><i class="ph-fill ph-buildings text-xl"></i></div><div class="font-bold text-gray-700 text-sm">${i.name}</div></div><div class="flex items-end gap-4 h-32 mt-auto px-2"><div class="w-1/2 flex flex-col justify-end h-full"><div class="text-center text-[10px] text-gray-400 font-bold mb-1">Before</div><div class="w-full bg-gray-200 rounded-t flex justify-center items-end" style="height:${(i.before/Math.max(i.before,i.after)*1.1)*100}%"><span class="text-xs font-bold text-gray-500 mb-1">${i.before}</span></div></div><div class="w-1/2 flex flex-col justify-end h-full relative"><div class="absolute -top-8 left-1/2 -translate-x-1/2 bg-red-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm">UP!</div><div class="text-center text-[10px] text-primary font-bold mb-1">After</div><div class="w-full bg-gradient-to-t from-blue-600 to-cyan-400 rounded-t flex justify-center items-end" style="height:${(i.after/Math.max(i.before,i.after)*1.1)*100}%"><span class="text-sm font-bold text-white mb-1 shadow-sm">${i.after}${i.unit}</span></div></div></div><div class="text-center text-xs font-bold text-gray-500 border-t pt-3 mt-2">${i.metric}</div></div>`).join('');
      return `<section class="py-24 bg-white"><div class="container mx-auto px-6"><h2 class="text-3xl font-bold text-center text-gray-900 mb-12">${d.title}</h2><div class="grid md:grid-cols-3 gap-6">${c}</div></div></section>`;
    }
    function tplFaq(d) {
      const i=d.items.map(x=>`<details class="group border border-gray-200 rounded-lg open:bg-gray-50 transition"><summary class="flex justify-between items-center font-bold cursor-pointer list-none p-4 text-gray-800"><span>${x.q}</span><span class="transition group-open:rotate-180"><i class="ph ph-caret-down"></i></span></summary><div class="text-gray-600 text-sm p-4 pt-0 leading-relaxed border-t border-gray-100 mt-2">${x.a}</div></details>`).join('');
      return `<section class="py-20 bg-white border-t border-gray-100"><div class="container mx-auto px-6 max-w-3xl"><h2 class="text-3xl font-bold text-center mb-12 text-gray-900">${d.title}</h2><div class="space-y-4">${i}</div></div></section>`;
    }

    /* --- Editor Logic --- */

    function switchTab(tab) {
      currentTab = tab;
      const tG = document.getElementById('tab-global');
      const tS = document.getElementById('tab-section');
      const active = 'flex-1 py-3 text-xs font-bold text-blue-500 border-b-2 border-blue-500';
      const inactive = 'flex-1 py-3 text-xs font-bold text-slate-400 border-b-2 border-transparent hover:text-white';
      if(tab==='global'){tG.className=active; tS.className=inactive;} else {tG.className=inactive; tS.className=active;}
      renderEditor();
    }

    function selectSection(id) { activeId = id; switchTab('section'); render(); }

    function renderEditor() {
      const container = document.getElementById('editor-content');
      container.innerHTML = '';

      if (currentTab === 'global') {
        const g = lpData.global;
        container.innerHTML = `
          <div class="mb-4 text-xs font-bold text-slate-400 uppercase tracking-widest">Global Settings</div>
          <div id="global-settings" class="space-y-4"></div>
          <div class="border-t border-slate-700 pt-4 mt-4">
            <div class="text-xs font-bold text-blue-400 mb-2">ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼è¨­å®š</div>
            <div id="global-theme" class="space-y-4"></div>
          </div>
        `;
        
        const wrap = container.querySelector('#global-settings');
        wrap.appendChild(createInput('ã‚µãƒ¼ãƒ“ã‚¹å', 'global.serviceName', g.serviceName));
        wrap.appendChild(createInput('ä¼šç¤¾å (Footer)', 'global.companyName', g.companyName));
        wrap.appendChild(createInput('ä¼šç¤¾ãƒ­ã‚´URL', 'global.logoUrl', g.logoUrl));
        wrap.appendChild(createInput('SPå›ºå®šãƒœã‚¿ãƒ³æ–‡è¨€', 'global.ctaText', g.ctaText));
        wrap.appendChild(createInput('ãƒªãƒ³ã‚¯', 'global.ctaUrl', g.ctaUrl));
        wrap.appendChild(createInput('è³‡æ–™ã‚µãƒ ãƒã‚¤ãƒ«URL', 'global.materialThumb', g.materialThumb));
        wrap.appendChild(createInput('è³‡æ–™ãƒãƒŠãƒ¼ï¼šãƒªãƒ¼ãƒ‰æ–‡ï¼ˆä¾‹ï¼šè©³ã—ãçŸ¥ã‚ŠãŸã„æ–¹ï¼‰', 'global.materialLeadText', g.materialLeadText));
        wrap.appendChild(createColorInput('è³‡æ–™ãƒãƒŠãƒ¼ï¼šã‚°ãƒ©ãƒ‡å·¦è‰²',  'global.materialBackgroundStart', g.materialBackgroundStart));
        wrap.appendChild(createColorInput('è³‡æ–™ãƒãƒŠãƒ¼ï¼šã‚°ãƒ©ãƒ‡å³è‰²',  'global.materialBackgroundEnd', g.materialBackgroundEnd));
        
        const wrapTheme = container.querySelector('#global-theme');
        wrapTheme.appendChild(createColorInput('ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ¼', 'global.primaryColor', g.primaryColor));
        wrapTheme.appendChild(createColorInput('ã‚»ã‚«ãƒ³ãƒ€ãƒªãƒ¼', 'global.secondaryColor', g.secondaryColor));

      } else {
        const section = lpData.sections.find(s => s.id === activeId);
        if (!section) {
          container.innerHTML = '<p class="text-slate-500 text-center mt-10 text-xs">ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„</p>';
          return;
        }

        const controls = document.createElement('div');
        controls.className = 'grid grid-cols-3 gap-2 mb-6 pb-6 border-b border-slate-700';
        controls.innerHTML = `
          <button class="bg-slate-800 hover:bg-slate-700 text-white py-2 rounded text-xs font-bold border border-slate-600" onclick="moveSection(-1)">â†‘ ä¸Šã¸</button>
          <button class="bg-slate-800 hover:bg-slate-700 text-white py-2 rounded text-xs font-bold border border-slate-600" onclick="moveSection(1)">â†“ ä¸‹ã¸</button>
          <button class="bg-red-900/30 hover:bg-red-900/50 text-red-400 py-2 rounded text-xs font-bold border border-red-900" onclick="deleteSection()">å‰Šé™¤</button>
        `;
        container.appendChild(controls);

        const d = section.data;

        if (section.type === 'hero') {
          // Laurel Removed
          container.appendChild(createInput('ã‚¿ã‚°ãƒ©ã‚¤ãƒ³', 'tagline', d.tagline));
          container.appendChild(createInput('ã‚¿ã‚¤ãƒˆãƒ«', 'title', d.title));
          container.appendChild(createTextArea('èª¬æ˜æ–‡', 'desc', d.desc));
          container.appendChild(createInput('å®Ÿç¸¾æ•°', 'userCount', d.userCount));
          container.appendChild(createInput('èƒŒæ™¯ç”»åƒURL', 'bgImage', d.bgImage));
          const layoutSel = document.createElement('div'); layoutSel.className='mb-4';
          layoutSel.innerHTML = `<label class="editor-label">ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ</label><select class="editor-select" onchange="updateValue('layout', this.value)"><option value="split" ${d.layout==='split'?'selected':''}>å·¦å³åˆ†å‰²</option><option value="overlay_box" ${d.layout==='overlay_box'?'selected':''}>èƒŒæ™¯ç”»åƒï¼‹ç™½ãƒœãƒƒã‚¯ã‚¹</option></select>`;
          container.appendChild(layoutSel);
          container.appendChild(createTextArea('HubSpotãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰', 'formCode', d.formCode));
          container.appendChild(createSubCtaEditor(d));
        }
        else if (section.type === 'cta_middle') {
          container.appendChild(createInput('ã‚¿ã‚¤ãƒˆãƒ«', 'title', d.title));
          container.appendChild(createTextArea('èª¬æ˜æ–‡', 'desc', d.desc));
          container.appendChild(createInput('ãƒ¡ã‚¤ãƒ³ãƒœã‚¿ãƒ³æ–‡è¨€', 'btnText', d.btnText));
          container.appendChild(createInput('ãƒ¡ã‚¤ãƒ³ãƒœã‚¿ãƒ³ãƒªãƒ³ã‚¯', 'btnUrl', d.btnUrl));
          container.appendChild(createInput('èƒŒæ™¯ç”»åƒURL', 'bgImage', d.bgImage));
          container.appendChild(createInput('å¹ãå‡ºã— (MicroCopy)', 'microCopy', d.microCopy));
          container.appendChild(createSubCtaEditor(d));
        }
        else if (section.type === 'logos') {
          container.appendChild(createInput('ã‚¿ã‚¤ãƒˆãƒ«', 'title', d.title));
          d.items.forEach((item, idx) => {
             const w = createPanel(`Logo ${idx+1}`, () => removeArrayItem('items', idx));
             w.appendChild(createSubInput('ãƒ­ã‚´ç”»åƒURL', `items.${idx}`, item));
             container.appendChild(w);
          });
          container.appendChild(createAddBtn('ãƒ­ã‚´è¿½åŠ ', () => addArrayItem('items', 'https://placehold.co/200x80?text=Logo')));
        }
        else if (section.type === 'feature_hero') {
           container.appendChild(createInput('ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«', 'subTitle', d.subTitle));
           container.appendChild(createInput('ã‚¿ã‚¤ãƒˆãƒ«', 'title', d.title));
           container.appendChild(createTextArea('èª¬æ˜', 'desc', d.desc));
           container.appendChild(createInput('ç”»åƒURL', 'image', d.image));
           d.checklist.forEach((item, idx) => {
              const w = createPanel(`Check ${idx+1}`, () => removeArrayItem('checklist', idx));
              w.appendChild(createSubInput('ãƒ†ã‚­ã‚¹ãƒˆ', `checklist.${idx}`, item));
              container.appendChild(w);
           });
           container.appendChild(createAddBtn('ãƒã‚§ãƒƒã‚¯é …ç›®è¿½åŠ ', () => addArrayItem('checklist', 'æ–°è¦æ©Ÿèƒ½')));
        }
        else if (section.type === 'case_study_detail') {
          container.appendChild(createInput('ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒˆãƒ«', 'title', d.title));
          d.items.forEach((item, idx) => {
            const w = createPanel(`äº‹ä¾‹ ${idx+1}`, () => removeArrayItem('items', idx));
            w.appendChild(createSubInput('åŒ»é™¢å', `items.${idx}.name`, item.name));
            w.appendChild(createSubInput('è¦‹å‡ºã—', `items.${idx}.headline`, item.headline));
            w.appendChild(createSubTextArea('è©³ç´°èª¬æ˜', `items.${idx}.desc`, item.desc));
            w.appendChild(createSubInput('ç”»åƒ1 URL', `items.${idx}.image1`, item.image1));
            w.appendChild(createSubInput('ç”»åƒ2 URL', `items.${idx}.image2`, item.image2));
            
            const gBox = document.createElement('div'); gBox.className = 'bg-slate-800 p-3 rounded mt-2';
            gBox.innerHTML = '<div class="text-xs font-bold text-green-400 mb-2">ã‚°ãƒ©ãƒ•è¨­å®š</div>';
            gBox.appendChild(createSubInputRawSelect(['bar','pie'], `items.${idx}.graphType`, item.graphType));
            gBox.appendChild(createSubInput('ãƒ©ãƒ™ãƒ«', `items.${idx}.metric.label`, item.metric.label));
            const numRow = document.createElement('div'); numRow.className='grid grid-cols-2 gap-2 mt-1';
            if(item.graphType === 'bar') numRow.appendChild(createSubInput('Before', `items.${idx}.metric.before`, item.metric.before, 'number'));
            numRow.appendChild(createSubInput(item.graphType==='bar'?'After':'æ•°å€¤', `items.${idx}.metric.after`, item.metric.after, 'number'));
            gBox.appendChild(numRow);
            gBox.appendChild(createSubInput('å˜ä½', `items.${idx}.metric.unit`, item.metric.unit));
            w.appendChild(gBox);
            
            container.appendChild(w);
          });
          container.appendChild(createAddBtn('äº‹ä¾‹è¿½åŠ ', () => addArrayItem('items', {name:'New', headline:'Title', desc:'...', metric:{label:'å£²ä¸Š', before:0, after:100, unit:'ä¸‡'}, graphType:'bar'})));
        }
        else if (section.type === 'comparison') {
          container.appendChild(createInput('ã‚¿ã‚¤ãƒˆãƒ«', 'title', d.title));
          const colPanel = document.createElement('div'); colPanel.className = 'panel-card mb-4';
          colPanel.innerHTML = '<div class="text-xs font-bold text-blue-400 mb-2">æ¯”è¼ƒå¯¾è±¡ï¼ˆåˆ—ï¼‰</div>';
          d.cols.forEach((col, idx) => {
             const div = document.createElement('div'); div.className='flex gap-2 mb-2';
             div.appendChild(createSubInputRaw(col, (v)=>updateNestedData(`cols.${idx}`, v)));
             if(idx > 0) { const btn = document.createElement('button'); btn.innerHTML='<i class="ph ph-trash"></i>'; btn.className='text-red-400 px-2'; btn.onclick=()=>removeArrayItem('cols', idx); div.appendChild(btn); }
             colPanel.appendChild(div);
          });
          colPanel.appendChild(createAddBtn('åˆ—ã‚’è¿½åŠ ', () => { addArrayItem('cols', 'ä»–ç¤¾'); d.rows.forEach((r,ri)=>addArrayItem(`rows.${ri}.values`, '-')); }));
          container.appendChild(colPanel);
          d.rows.forEach((row, idx) => {
            const w = createPanel(`è¡Œ ${idx+1}: ${row.label}`, () => removeArrayItem('rows', idx));
            w.appendChild(createSubInput('é …ç›®å', `rows.${idx}.label`, row.label));
            row.values.forEach((val, vi) => {
               const colName = d.cols[vi] || `åˆ—${vi+1}`;
               w.appendChild(createSubInput(colName, `rows.${idx}.values.${vi}`, val));
            });
            container.appendChild(w);
          });
          container.appendChild(createAddBtn('è¡Œè¿½åŠ ', () => addArrayItem('rows', {label:'é …ç›®', values: Array(d.cols.length).fill('-')})));
        }
        else if (section.type === 'strengths') {
          container.appendChild(createInput('ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«', 'subTitle', d.subTitle));
          container.appendChild(createInput('ãƒ¡ã‚¤ãƒ³ã‚¿ã‚¤ãƒˆãƒ«', 'mainTitle', d.mainTitle));
          d.features.forEach((f, idx) => {
            const w = createPanel(`Point ${idx+1}`, () => removeArrayItem('features', idx));
            w.appendChild(createSubInput('ã‚¿ã‚¤ãƒˆãƒ«', `features.${idx}.title`, f.title));
            w.appendChild(createSubTextArea('èª¬æ˜', `features.${idx}.desc`, f.desc));
            w.appendChild(createGradientSelect('ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³', `features.${idx}.color`, f.color));
            container.appendChild(w);
          });
          container.appendChild(createAddBtn('å¼·ã¿è¿½åŠ ', () => addArrayItem('features', {title:'New', desc:'...', color:GRADIENTS[0].value})));
        }
        else if (section.type === 'pricing') {
          container.appendChild(createInput('ã‚¿ã‚¤ãƒˆãƒ«', 'title', d.title));
          container.appendChild(createTextArea('èª¬æ˜', 'desc', d.desc));
          d.plans.forEach((p, idx) => {
            const w = createPanel(`Plan ${idx+1}`, () => removeArrayItem('plans', idx));
            w.appendChild(createSubInput('ãƒ—ãƒ©ãƒ³å', `plans.${idx}.name`, p.name));
            w.appendChild(createSubInput('ä¾¡æ ¼', `plans.${idx}.price`, p.price));
            w.appendChild(createSubTextArea('ç‰¹å¾´', `plans.${idx}.features`, p.features));
            const chkId = `chk-${idx}`;
            const chk = document.createElement('div'); chk.className = 'mt-2 flex items-center gap-2';
            chk.innerHTML = `<input type="checkbox" id="${chkId}" ${p.highlight?'checked':''} onchange="updateNestedData('plans.${idx}.highlight', this.checked)"><label for="${chkId}" class="text-xs">ãŠã™ã™ã‚</label>`;
            w.appendChild(chk);
            container.appendChild(w);
          });
          container.appendChild(createAddBtn('ãƒ—ãƒ©ãƒ³è¿½åŠ ', () => addArrayItem('plans', {name:'New', price:'-', features:'-', highlight:false})));
        }
        else if (section.type === 'faq') {
          container.appendChild(createInput('ã‚¿ã‚¤ãƒˆãƒ«', 'title', d.title));
          d.items.forEach((item, idx) => {
            const w = createPanel(`Q&A ${idx+1}`, () => removeArrayItem('items', idx));
            w.appendChild(createSubInput('è³ªå•', `items.${idx}.q`, item.q));
            w.appendChild(createSubTextArea('å›ç­”', `items.${idx}.a`, item.a));
            container.appendChild(w);
          });
          container.appendChild(createAddBtn('è³ªå•è¿½åŠ ', () => addArrayItem('items', {q:'è³ªå•', a:'å›ç­”'})));
        }
        else if (section.type === 'achievements') {
          container.appendChild(createInput('ã‚¿ã‚¤ãƒˆãƒ«', 'title', d.title));
          d.items.forEach((item, idx) => {
            const w = createPanel(`å®Ÿç¸¾ ${idx+1}`, () => removeArrayItem('items', idx));
            w.appendChild(createSubInput('åç§°', `items.${idx}.name`, item.name));
            w.appendChild(createSubInput('æŒ‡æ¨™', `items.${idx}.metric`, item.metric));
            const g = document.createElement('div'); g.className='grid grid-cols-2 gap-2 mt-2';
            g.appendChild(createSubInput('Before', `items.${idx}.before`, item.before, 'number'));
            g.appendChild(createSubInput('After', `items.${idx}.after`, item.after, 'number'));
            w.appendChild(g);
            w.appendChild(createSubInput('å˜ä½', `items.${idx}.unit`, item.unit));
            container.appendChild(w);
          });
          container.appendChild(createAddBtn('å®Ÿç¸¾è¿½åŠ ', () => addArrayItem('items', {name:'New', metric:'KPI', before:0, after:100, unit:'%'})));
        }
        else if (section.type === 'contact') {
          container.appendChild(createInput('ã‚¿ã‚¤ãƒˆãƒ«', 'title', d.title));
          container.appendChild(createTextArea('èª¬æ˜æ–‡', 'desc', d.desc));
          container.appendChild(createTextArea('HubSpotãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰', 'formCode', d.formCode));
          container.appendChild(createInput('å¹ãå‡ºã— (MicroCopy)', 'microCopy', d.microCopy));
          container.appendChild(createSubCtaEditor(d));
        }
        else if (section.type === 'problem') {
          container.appendChild(createInput('ã‚¿ã‚¤ãƒˆãƒ«', 'title', d.title));
          d.items.forEach((item, idx) => {
            const w = createPanel(`èª²é¡Œ ${idx+1}`, () => removeArrayItem('items', idx));
            w.appendChild(createSubInput('ã‚¿ã‚¤ãƒˆãƒ«', `items.${idx}.title`, item.title));
            w.appendChild(createSubTextArea('èª¬æ˜', `items.${idx}.desc`, item.desc));
            container.appendChild(w);
          });
          container.appendChild(createAddBtn('èª²é¡Œè¿½åŠ ', () => addArrayItem('items', {title:'æ–°è¦èª²é¡Œ', desc:'èª¬æ˜'})));
        }
        else if (section.type === 'agitation') {
          container.appendChild(createInput('ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼', 'title', d.title));
          container.appendChild(createTextArea('ãƒªãƒ¼ãƒ‰æ–‡', 'desc', d.desc));
          container.appendChild(createInput('ãƒãƒƒã‚¸æ–‡è¨€', 'badge', d.badge));
        }
        else if (section.type === 'flow') {
          container.appendChild(createInput('ã‚¿ã‚¤ãƒˆãƒ«', 'title', d.title));
          d.steps.forEach((step, idx) => {
            const w = createPanel(`Step ${idx+1}`, () => removeArrayItem('steps', idx));
            w.appendChild(createSubInput('ã‚¿ã‚¤ãƒˆãƒ«', `steps.${idx}.title`, step.title));
            w.appendChild(createSubTextArea('èª¬æ˜', `steps.${idx}.desc`, step.desc));
            container.appendChild(w);
          });
          container.appendChild(createAddBtn('ã‚¹ãƒ†ãƒƒãƒ—è¿½åŠ ', () => addArrayItem('steps', {title:'æ¬¡ã¸', desc:'...'})));
        }
      }
    }

    /* --- UI Helpers --- */

    function createInput(label, path, val) {
      const d = document.createElement('div'); d.className = 'mb-4';
      d.innerHTML = `<label class="editor-label">${label}</label><input type="text" class="editor-input" value="${val}" oninput="updateValue('${path}', this.value)">`;
      return d;
    }
    function createColorInput(label, path, val) {
      const d = document.createElement('div'); d.className = 'mb-4';
      d.innerHTML = `<label class="editor-label">${label}</label><div class="flex gap-2"><input type="color" class="h-9 w-9 p-0 border-0 bg-transparent cursor-pointer" value="${val}" oninput="updateValue('${path}', this.value)"><input type="text" class="editor-input flex-1" value="${val}" oninput="updateValue('${path}', this.value)"></div>`;
      return d;
    }
    function createTextArea(label, path, val) {
      const d = document.createElement('div'); d.className = 'mb-4';
      d.innerHTML = `<label class="editor-label">${label}</label><textarea class="editor-textarea h-20" oninput="updateValue('${path}', this.value)">${val}</textarea>`;
      return d;
    }
    function createSubInput(label, path, val, type='text') {
      const d = document.createElement('div'); d.className = 'mb-2';
      d.innerHTML = `<label class="editor-label text-[10px] text-slate-500">${label}</label><input type="${type}" class="editor-input py-1 text-xs" value="${val}" oninput="updateNestedData('${path}', this.value)">`;
      return d;
    }
    function createSubInputRaw(val, onChange) {
      const inp = document.createElement('input'); inp.type='text'; inp.className='editor-input py-1 text-xs flex-1'; inp.value=val;
      inp.oninput = (e) => onChange(e.target.value); return inp;
    }
    function createSubInputRawSelect(opts, path, val) {
      const sel = document.createElement('select'); sel.className='editor-select py-1 text-xs mb-1';
      opts.forEach(o => { const op = document.createElement('option'); op.value=o; op.text=o; if(o===val) op.selected=true; sel.appendChild(op); });
      sel.onchange = (e) => updateNestedData(path, e.target.value);
      return sel;
    }
    function createSubTextArea(label, path, val) {
      const d = document.createElement('div'); d.className = 'mb-2';
      d.innerHTML = `<label class="editor-label text-[10px] text-slate-500">${label}</label><textarea class="editor-textarea py-1 text-xs h-16" oninput="updateNestedData('${path}', this.value)">${val}</textarea>`;
      return d;
    }
    function createGradientSelect(label, path, val) {
      const d = document.createElement('div'); d.className = 'mb-2';
      const options = GRADIENTS.map(g => `<option value="${g.value}" ${val===g.value?'selected':''}>${g.name}</option>`).join('');
      d.innerHTML = `<label class="editor-label text-[10px] text-slate-500">${label}</label><select class="editor-select py-1 text-xs" onchange="updateNestedData('${path}', this.value)">${options}</select>`;
      return d;
    }
    function createPanel(title, onDelete) {
      const d = document.createElement('div'); d.className = 'panel-card';
      d.innerHTML = `<div class="flex justify-between items-center mb-2 pb-2 border-b border-slate-700"><span class="text-xs font-bold text-blue-400">${title}</span><button class="text-slate-500 hover:text-red-400"><i class="ph-bold ph-trash"></i></button></div>`;
      d.querySelector('button').onclick = onDelete; return d;
    }
    function createAddBtn(text, onClick) {
      const b = document.createElement('button');
      b.className = 'w-full py-2 border border-dashed border-slate-600 rounded text-xs text-slate-400 hover:text-blue-400 hover:border-blue-400 transition mb-6';
      b.innerText = `+ ${text}`; b.onclick = onClick; return b;
    }
    function createSubCtaEditor(d) {
      const div = document.createElement('div'); div.className = 'panel-card mt-4';
      div.innerHTML = `<div class="text-xs font-bold text-green-400 mb-2">ã‚µãƒ–CTA (è³‡æ–™è«‹æ±‚ãƒœã‚¿ãƒ³)</div>`;
      const chkId = `chk-subcta-${Date.now()}`;
      const chk = document.createElement('div'); chk.className = 'mb-2 flex items-center gap-2';
      chk.innerHTML = `<input type="checkbox" id="${chkId}" ${d.showSubCta?'checked':''} onchange="updateValue('showSubCta', this.checked)"><label for="${chkId}" class="text-xs">è¡¨ç¤ºã™ã‚‹</label>`;
      div.appendChild(chk);
      if(d.showSubCta) {
        div.appendChild(createSubInput('ãƒœã‚¿ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ', 'subCtaText', d.subCtaText));
        div.appendChild(createSubInput('ãƒªãƒ³ã‚¯URL', 'subCtaUrl', d.subCtaUrl));
      }
      return div;
    }

    /* --- Logic --- */
    function updateValue(path, value) {
      if(path.startsWith('global.')) lpData.global[path.split('.')[1]] = value;
      else { const s = lpData.sections.find(x => x.id === activeId); if(s) s.data[path] = value; }
      render();
    }
    function updateNestedData(path, value) {
      const s = lpData.sections.find(x => x.id === activeId); if(!s) return;
      const keys = path.split('.'); let t = s.data;
      for(let i=0; i<keys.length-1; i++) t = t[keys[i]];
      const last = keys[keys.length-1];
      if(!isNaN(value) && value!=='' && typeof t[last]==='number') t[last] = Number(value); else t[last] = value;
      render();
    }
    function addArrayItem(key, item) {
      const s = lpData.sections.find(x => x.id === activeId);
      if(s) {
         const keys = key.split('.'); let t = s.data; for(let i=0; i<keys.length; i++) t = t[keys[i]];
         t.push(item); render(); renderEditor(); 
      }
    }
    function removeArrayItem(key, idx) {
      if(!confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
      const s = lpData.sections.find(x => x.id === activeId);
      if(s) { s.data[key].splice(idx, 1); render(); renderEditor(); }
    }
    function addSection(type) {
      const id = 's_' + Date.now();
      let d = {};
      if(type==='hero') d={tagline:'Tag', title:'Title', desc:'Desc', userCount:'100+', formCode:'', layout:'split', showSubCta:false, subCtaText:'è³‡æ–™è«‹æ±‚', subCtaUrl:'#'};
      if(type==='logos') d={title:'å°å…¥å®Ÿç¸¾', items:['https://placehold.co/200x80/e2e8f0/94a3b8?text=Logo']};
      if(type==='problem') d={title:'èª²é¡Œ', items:[{title:'èª²é¡Œ1', desc:'è©³ç´°'}]};
      if(type==='agitation') d={title:'ã‚­ãƒ£ãƒƒãƒ', desc:'ãƒªãƒ¼ãƒ‰æ–‡', badge:'ãƒãƒƒã‚¸'};
      if(type==='feature_hero') d={subTitle:'Service', title:'Title', desc:'Desc', checklist:['Feature 1'], image:''};
      if(type==='comparison') d={title:'æ¯”è¼ƒ', cols:['è‡ªç¤¾','ä»–ç¤¾'], rows:[{label:'é …ç›®', values:['â—‹','Ã—']}]};
      if(type==='strengths') d={subTitle:'Point', mainTitle:'å¼·ã¿', features:[{title:'å¼·ã¿1', desc:'è©³ç´°', color:GRADIENTS[0].value}]};
      if(type==='achievements') d={title:'å®Ÿç¸¾', items:[{name:'Aç¤¾', metric:'å£²ä¸Š', before:10, after:20, unit:'ä¸‡'}]};
      if(type==='pricing') d={title:'æ–™é‡‘', desc:'...', plans:[{name:'Basic', price:'-', features:'-', highlight:false}]};
      if(type==='flow') d={title:'æµã‚Œ', steps:[{title:'Step1', desc:'å†…å®¹'}]};
      if(type==='faq') d={title:'FAQ', items:[{q:'è³ªå•', a:'å›ç­”'}]};
      if(type==='contact') d={title:'ãŠå•ã„åˆã‚ã›', desc:'...', formCode:'', showSubCta:false, subCtaText:'è³‡æ–™è«‹æ±‚', subCtaUrl:'#', microCopy: 'ç°¡å˜30ç§’'};
      if(type==='cta_middle') d={title:'CTA', desc:'...', btnText:'Click', btnUrl:'#', showSubCta:false, subCtaText:'Sub', subCtaUrl:'#', microCopy: '30ç§’ã§å®Œäº†'};
      if(type==='case_study_detail') d={title:'å°å…¥æˆåŠŸäº‹ä¾‹', items:[{name:'Aç¤¾', headline:'æˆæœ', desc:'...', image1:'', image2:'', graphType:'bar', metric:{label:'å£²ä¸Š', before:100, after:150, unit:'ä¸‡'}}]};

      lpData.sections.push({ id, type, data: d });
      activeId = id; render(); switchTab('section');
      setTimeout(() => document.getElementById('preview-area').scrollTop = 99999, 100);
    }
    function moveSection(dir) {
      const i = lpData.sections.findIndex(x => x.id === activeId);
      if(i === -1) return;
      const t = i + dir;
      if(t >= 0 && t < lpData.sections.length) {
        [lpData.sections[i], lpData.sections[t]] = [lpData.sections[t], lpData.sections[i]];
        render();
      }
    }
    function deleteSection() {
      if(!confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
      lpData.sections = lpData.sections.filter(x => x.id !== activeId);
      activeId = null; render(); renderEditor();
    }
    
    // Export Function
    function exportHtml() {
      const content = document.getElementById('canvas').innerHTML;
      const cssVarsMatch = content.match(/<style>[\s\S]*?:root[\s\S]*?<\/style>/);
      const cssVars = cssVarsMatch ? cssVarsMatch[0] : '';

      const head = `<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Landing Page</title>
  <script src="https://cdn.tailwindcss.com"><\/script>
  <script src="https://unpkg.com/@phosphor-icons/web"><\/script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+JP:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', 'Noto Sans JP', sans-serif; }
    /* Animation for Marquee */
    @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
    .animate-marquee { animation: marquee 25s linear infinite; }
    
    /* Material Banner Styles */
    .material-banner {
      display: flex; align-items: center; background: #ffffff;
      border: 1px solid #e2e8f0; border-radius: 12px;
      padding: 12px 16px; text-decoration: none; color: #334155;
      box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); transition: all 0.2s ease;
      max-width: 360px; margin: 0 auto; position: relative; overflow: hidden;
    }
    .material-banner:hover {
      transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); border-color: #cbd5e1;
    }
    .material-banner__icon {
      width: 32px; height: 32px; background: #f1f5f9; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 10px; color: #94a3b8; margin-right: 12px; flex-shrink: 0;
    }
    .material-banner__text { text-align: left; flex: 1; padding-right: 12px; }
    .material-banner__text .line1 { display: block; font-size: 10px; color: #64748b; font-weight: bold; margin-bottom: 2px; letter-spacing: 0.05em; }
    .material-banner__text .line2 { display: block; font-size: 13px; font-weight: bold; color: #0f172a; line-height: 1.4; }
    .material-banner__thumb-group { position: relative; width: 32px; height: 42px; flex-shrink: 0; }
    .material-banner__thumb-group .thumb { position: absolute; border: 1px solid #e2e8f0; background: white; border-radius: 2px; }
    .material-banner__thumb-group .d1 { width: 28px; height: 36px; right: 4px; bottom: 4px; background: #f1f5f9; z-index: 1; }
    .material-banner__thumb-group .d2 { width: 28px; height: 36px; right: 2px; bottom: 2px; background: #fff; transform: rotate(-2deg); z-index: 2;}
    .material-banner__thumb-group .main { width: 28px; height: 36px; right: 0; bottom: 0; z-index: 2; object-fit: cover; box-shadow: -2px 2px 4px rgba(0,0,0,0.1); }
  </style>
  ${cssVars}
  <script src="//js-na2.hsforms.net/forms/embed/v2.js"><\/script>
</head>
<body>`;
      
      const foot = `
  <script>
    window.addEventListener('load', function() {
      if(window.hbspt) {
        document.querySelectorAll('.hs-form-wrapper').forEach(w => {
          window.hbspt.forms.create({
            region: w.dataset.region,
            portalId: w.dataset.portalId,
            formId: w.dataset.formId,
            target: '#' + w.id
          });
        });
      }
    });
  <\/script>
</body>
</html>`;
      
      const fullHtml = head + content + foot;
      navigator.clipboard.writeText(fullHtml).then(() => alert('å®Œå…¨ãªHTMLã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼\n.htmlãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã—ã¦ãã ã•ã„ã€‚'));
    }

    render(); renderEditor();
  </script>
</body>
</html>
